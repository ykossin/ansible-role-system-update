# –ê–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ä–æ–ª–∏ system-update

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** —è–Ω–≤–∞—Ä—å 2026

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:

1. **–ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. **–ì–∏–±–∫–æ—Å—Ç—å** - –º–Ω–æ–≥–æ –æ–ø—Ü–∏–π –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è
3. **–¢–µ–≥–∏** - —Ö–æ—Ä–æ—à–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–≥–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω—ã
5. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —è–¥—Ä–∞

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–´ –ò –ù–ï–î–û–°–¢–ê–¢–ö–ò

### 1. –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∏—Ç—å –º–µ—Å—Ç–∞, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—à–∏–±–∫–µ –∏ —á–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

#### ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

#### ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–ø–∞–¥–µ—Ç, —Ä–æ–ª—å –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –æ—à–∏–±–∫—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏ `rescue` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.

#### ‚ùå –ù–µ–ø–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω unattended-upgrades
**–ü—Ä–æ–±–ª–µ–º–∞:** –í —à–∞–±–ª–æ–Ω–µ –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (security, updates).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é unattended-upgrades.

### 2. –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–æ–ª—å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –≤–µ—Ä—Å–∏—è—Ö.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä—Å–∏–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞ –≤ –Ω–∞—á–∞–ª–µ —Ä–æ–ª–∏.

#### ‚ö†Ô∏è –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, —á—Ç–æ –±—ã–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ñ–∞–π–ª.

#### ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ `dpkg --audit` –∏ `apt-get check`.

#### ‚ö†Ô∏è –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ dry-run
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∂–∏–º —Å–∏–º—É–ª—è—Ü–∏–∏ (dry-run).

### 3. –£–ª—É—á—à–µ–Ω–∏—è —É–¥–æ–±—Å—Ç–≤–∞

#### üí° –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–∑–º–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –≤–∏–¥–Ω–æ, —Å–∫–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π.

#### üí° –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –æ—Ç–∫–∞—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞.

#### üí° –ù–µ—Ç –±—ç–∫–∞–ø–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–≤–∞—Ç—å –±—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

#### üí° –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (—è–¥—Ä–æ, systemd) –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

---

## üîß –ü–†–ï–î–õ–û–ñ–ï–ù–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### –£–ª—É—á—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

```yaml
- name: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
  stat:
    path: /
  register: root_fs

- name: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–≤–æ–±–æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
  command: df -BG / | tail -1 | awk '{print $4}'
  register: free_space_gb
  changed_when: false

- name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
  fail:
    msg: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º {{ system_min_free_space_gb }}GB, –¥–æ—Å—Ç—É–ø–Ω–æ {{ free_space_gb.stdout }}GB"
  when:
    - (free_space_gb.stdout | int) < (system_min_free_space_gb | int)
```

### –£–ª—É—á—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

```yaml
- name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
  uri:
    url: "{{ item }}"
    method: HEAD
    status_code: [200, 301, 302]
    timeout: 10
  loop: "{{ system_repositories_to_check }}"
  register: repo_check
  failed_when: false
  changed_when: false

- name: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö
  debug:
    msg: "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π {{ item.item }} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
  loop: "{{ repo_check.results }}"
  when: item.status != 200
```

### –£–ª—É—á—à–µ–Ω–∏–µ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```yaml
- name: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
  block:
    - name: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
      apt:
        name: "*"
        state: latest
        update_cache: false
      register: apt_upgrade
  rescue:
    - name: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      debug:
        msg: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: {{ ansible_failed_result.msg }}"
    - name: –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–º–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
      command: dpkg --configure -a
    - name: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      apt:
        name: "*"
        state: latest
        update_cache: false
      when: system_auto_fix_on_error
```

### –£–ª—É—á—à–µ–Ω–∏–µ 4: –ü–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω unattended-upgrades

```jinja2
// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ Ansible —Ä–æ–ª—å—é system-update

// –û–±–Ω–æ–≤–ª—è—Ç—å —Å–ø–∏—Å–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
Unattended-Upgrade::Update-Package-Lists "{{ system_unattended_upgrades_config.update_package_lists }}";

// –°–∫–∞—á–∏–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª—è–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã
Unattended-Upgrade::Download-Upgradeable-Packages "{{ system_unattended_upgrades_config.download_upgradeable_packages }}";

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
Unattended-Upgrade::Automatic-Reboot "{{ system_unattended_upgrades_config.automatic_reboot | default('false') }}";
Unattended-Upgrade::Automatic-Reboot-WithUsers "{{ system_unattended_upgrades_config.automatic_reboot_with_users | default('false') }}";
Unattended-Upgrade::Automatic-Reboot-Time "{{ system_unattended_upgrades_config.automatic_reboot_time | default('03:00') }}";

// –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
Unattended-Upgrade::Remove-Unused-Kernel-Packages "{{ system_unattended_upgrades_config.autoremove_packages }}";
Unattended-Upgrade::Remove-Unused-Dependencies "{{ system_unattended_upgrades_config.autoremove_packages }}";

// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
Unattended-Upgrade::AutoFixInterruptedDpkg "{{ system_unattended_upgrades_config.auto_fix_interrupted_dpkg }}";

// –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —à–∞–≥–∏
Unattended-Upgrade::MinimalSteps "{{ system_unattended_upgrades_config.minimal_steps }}";

// Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
{% if system_unattended_upgrades_config.mail_to | length > 0 %}
Unattended-Upgrade::Mail "{{ system_unattended_upgrades_config.mail_to }}";
Unattended-Upgrade::MailReport "{{ system_unattended_upgrades_config.mail_report }}";
Unattended-Upgrade::MailOnlyOnError {{ system_unattended_upgrades_config.mail_only_on_error }};
{% endif %}

// –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
Unattended-Upgrade::Origins-Pattern {
{% for origin in system_unattended_upgrades_origins %}
    "{{ origin }}";
{% endfor %}
};

// –ü–∞–∫–µ—Ç—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
Unattended-Upgrade::Package-Blacklist {
{% for package in system_unattended_upgrades_blacklist | default([]) %}
    "{{ package }}";
{% endfor %}
};
```

### –£–ª—É—á—à–µ–Ω–∏–µ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞

```yaml
- name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
  fail:
    msg: "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è {{ ansible_distribution }} {{ ansible_distribution_version }}"
  when:
    - ansible_distribution not in ['Debian', 'Ubuntu']
    - system_check_distribution_version

- name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
  fail:
    msg: "–¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º {{ system_min_distribution_version }}"
  when:
    - ansible_distribution_version | version_compare(system_min_distribution_version, '<')
    - system_check_distribution_version
```

### –£–ª—É—á—à–µ–Ω–∏–µ 6: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```yaml
- name: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
  copy:
    content: |
      –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: {{ ansible_date_time.iso8601 }}
      –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:
      {{ apt_upgrade.changes | default({}) | dict2items | map(attribute='key') | join('\n') }}
    dest: /var/log/ansible-system-update-{{ ansible_date_time.epoch }}.log
    mode: '0644'
  when:
    - apt_upgrade is defined
    - apt_upgrade.changed
    - system_log_updates
```

### –£–ª—É—á—à–µ–Ω–∏–µ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤

```yaml
- name: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  command: dpkg --audit
  register: dpkg_audit
  changed_when: false
  failed_when: false

- name: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–∞–∫–µ—Ç–∞–º–∏
  debug:
    msg: "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–∫–µ—Ç–∞–º–∏: {{ dpkg_audit.stdout }}"
  when:
    - dpkg_audit.rc != 0
    - dpkg_audit.stdout | length > 0

- name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π apt
  command: apt-get check
  register: apt_check
  changed_when: false
  failed_when: false

- name: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
  debug:
    msg: "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏: {{ apt_check.stderr }}"
  when:
    - apt_check.rc != 0
    - apt_check.stderr | length > 0
```

### –£–ª—É—á—à–µ–Ω–∏–µ 8: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```yaml
- name: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–∑–º–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  command: apt list --upgradable 2>/dev/null | grep -v "Listing..." | wc -l
  register: upgradable_count
  changed_when: false

- name: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  shell: |
    apt list --upgradable 2>/dev/null | \
    grep -v "Listing..." | \
    xargs -I {} apt-cache show {} 2>/dev/null | \
    grep "^Size:" | \
    awk '{sum+=$2} END {print sum/1024/1024}'
  register: upgrade_size_mb
  changed_when: false
  failed_when: false

- name: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
  debug:
    msg:
      - "–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {{ upgradable_count.stdout }}"
      - "–†–∞–∑–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: ~{{ upgrade_size_mb.stdout | default('–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') }} MB"
  when: system_show_upgrade_info
```

---

## üìù –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø –£–õ–£–ß–®–ï–ù–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. ‚úÖ –ü–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω unattended-upgrades

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞
6. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–£–¥–æ–±—Å—Ç–≤–æ):
8. ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
9. ‚úÖ –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
10. ‚úÖ Dry-run —Ä–µ–∂–∏–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–ù–∞—á–∞—Ç—å —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–∞, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
2. **–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –≤ `defaults/main.yml` –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
3. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ–¥ production

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** —è–Ω–≤–∞—Ä—å 2026
